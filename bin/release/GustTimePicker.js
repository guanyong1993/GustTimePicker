var GustTimePicker=function(g){var d=false,a,b=this,e;var f=function(h){return{start:h.selectionStart,length:h.selectionEnd-h.selectionStart}};this.onOpen=function(){d=true;var n=$(document.body);var p=g.offset().left;var o=g.offset().top+g.outerHeight();if(g[0].offsetParent.tagName.toLocaleLowerCase()!="body"){p=p-n.offset().left;o=o-n.offset().top}var i=n.width()-140;var h=n.height()-108;if(p>i){p=i}if(o>h){o=h}a=$('<div id="__gust_time_picker_container" style="left: '+p+"px; top: "+o+'px"><div class="item hour"><div class="minus">-</div><div class="value"><input type="text" class="text hour-text"/></div><div class="raise">+</div></div><div class="item minute"><div class="minus">-</div><div class="value"><input type="text" class="text minute-text"/></div><div class="raise">+</div></div><div class="confirm">确定</div></div>').appendTo(n);var l=g.val().split(":");if(null!=l&&l.length==2){e={hour:parseInt(l[0]),minute:parseInt(l[1])}}else{var j=new Date();e={hour:j.getHours(),minute:j.getMinutes()}}var m=e.hour<10?"0"+e.hour:e.hour;var k=e.minute<10?"0"+e.minute:e.minute;a.find(".hour .text").val(m);a.find(".minute .text").val(k);g.val(m+":"+k);var q=this;a.find(".hour .minus").click(function(){q.minus(1)});a.find(".hour .raise").click(function(){q.raise(1)});a.find(".text").focus(function(){$(this).select()});a.find(".text").keydown(function(y){var u=$(this);var t=(y.keyCode>=48&&y.keyCode<=57)||(y.keyCode>=96&&y.keyCode<=105);var w=y.keyCode==8||y.keyCode==37||y.keyCode==39;if(!w){if(t){var r=y.keyCode>=96?y.keyCode-96:y.keyCode-48;var x=60;if(u.hasClass("hour-text")){x=24}var s=f(this);var v=u.val();v=v.split("");v.splice(s.start,s.length,r+"");var z=v.join("");z=parseInt(z);if(z<x){u.val(z)}}return false}});a.find(".text").keyup(function(){var s=$(this);var t=parseInt(s.val());if(isNaN(t)){t=0}if(s.hasClass("hour-text")){e.hour=t}else{e.minute=t}var r=e.hour<10?"0"+e.hour:e.hour;var u=e.minute<10?"0"+e.minute:e.minute;g.val(r+":"+u)});a.find(".text").blur(function(){var r=$(this);var s=parseInt(r.val());if(isNaN(s)){if(r.hasClass("hour-text")){s=e.hour}else{s=e.minute}}if(s<10){s="0"+s}r.val(s)});a.find(".minute .minus").click(function(){q.minus(2)});a.find(".minute .raise").click(function(){q.raise(2)});a.find(".confirm").click(function(){q.onClose()})};this.onClose=function(){d=false;if(null!=a){a.empty();a.remove()}};this.openDelegate=function(){if(!d){b.onOpen()}};this.closeDelegate=function(h){if(d){if($(h.target).closest(a).length==0){b.onClose()}}};this.enable=function(){g[0].addEventListener("click",this.openDelegate,true);document.body.addEventListener("click",this.closeDelegate,true)};this.destroy=function(){g[0].removeEventListener("click",this.openDelegate,true);document.body.removeEventListener("click",this.closeDelegate,true);this.onClose();a=null;b=null;g=null};var c=function(i,j){var m,l;if(i=="hour"||i==1){m=e.hour+j;if(m<0){m=23}else{if(m>23){m=0}}l=e.minute}else{l=e.minute+j;if(l<0){l=59}else{if(l>59){l=0}}m=e.hour}e={hour:m,minute:l};var h=e.hour<10?"0"+e.hour:e.hour;var k=e.minute<10?"0"+e.minute:e.minute;a.find(".hour .text").val(h);a.find(".minute .text").val(k);g.val(h+":"+k)};this.minus=function(h){c(h,-1)};this.raise=function(h){c(h,1)}};